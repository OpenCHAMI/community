name: Regenerate ADR Index

on:
    push:
        paths:
            - 'adr/**'


permissions:
    contents: write


jobs:
    regenerate-index:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout repository
              uses: actions/checkout@v4

            - name: Regenerate ADR index
              uses: alexlovelltroy/adrctl-action@v1
              with:
                    command: index
                    directory: adr
                    out: "adr/README.md"

            - name: Commit and push changes
              run: |
                    git config --local user.name "github-actions[bot]"
                    git config --local user.email "github-actions[bot]@users.noreply.github.com"
                    if [[ -n $(git status --porcelain adr/README.md) ]]; then
                        git add adr/README.md
                        git commit -m "Regenerate ADR README.md [skip ci]"
                        git push
                    fi
